---
title: "Executive Summary"
output:
  pdf_document: default
  html_document: default
date: "2023-12-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo   =FALSE,      ## show or suppress the code
                      include=TRUE ,      ## show or suppress the output
                      message=FALSE,      ## omit messages generated by code
                      warning=FALSE,      ## omit warnings generated by code
                      comment=NA,         ## removes the ## from in front of outputs
                      fig.align="center", ## centers all figures
                      fig.height = 4,     ## set the default height
                      fig.width = 8      ## set the default width
                      )
library(tidyverse)
library(pubtheme)
library(gt)
```

```{r}
#Load data and perform some basic cleaning that will help with the visualizations
lobby_bills_df <- readRDS("data.rds")

#Create extended versions of variables for naming
lobby_bills_df <- lobby_bills_df %>% 
  mutate(Chamber_long = ifelse(Chamber == "H", "House", "Senate"), Party_long = ifelse(sponsors.party == "D", "Democrat", "Republican"))
```

```{r}
#set default colors. I chose to use these over the pubred and pubblue because red and blue imply Republican and Democrat. I will therefore only use those colors to signify party when appropriate
custom_teal <- "#429698"
custom_gold <- "#e6cd41"
```



```{r}
#First of three reuseable templates for plots because I use a similar format for several plots
barplot_lobby <- function(variable, data = lobby_bills_df, title = NULL, subtitle = NULL, caption = NULL, xlab = "Average Number of Times Lobbied", ylab = NULL, colors = NULL, group_cutoff = 0, order = T, auto_fill = custom_teal) {
  
  if(is.null(colors)) {
    grouped_data <- data %>%
      group_by(!!as.symbol(variable)) %>% 
      summarize(lobbying = mean(Code_appearances), size = n()) %>% 
      filter(size >= group_cutoff) %>% 
      arrange(lobbying) %>% 
      rename(variable = !!as.symbol(variable))
    
    if (order) {
      grouped_data <- grouped_data %>% 
        mutate(variable = factor(variable, levels = variable))
    }
    
    g <- ggplot(grouped_data, aes(x = lobbying, y = variable)) +
      geom_col(width = 0.8, fill = auto_fill)
  } else if (colors != variable) {
    grouped_data <- data %>%
      group_by(!!as.symbol(variable), !!as.symbol(colors)) %>% 
      summarize(lobbying = mean(Code_appearances), size = n()) %>% 
      filter(size >= group_cutoff) %>% 
      rename(fills = !!as.symbol(colors)) %>% 
      ungroup() %>% 
      arrange(lobbying) %>% 
      rename(variable = !!as.symbol(variable))
    
    if (order) {
      grouped_data <- grouped_data %>%
        mutate(variable = as.character(variable)) %>% 
        mutate(variable = factor(variable, levels = variable))
    }
    
    g <- ggplot(grouped_data, aes(x = lobbying, y = variable, fill = fills)) +
      geom_col(width = 0.8)
  } else if (colors == variable) {
    grouped_data <- data %>%
      group_by(!!as.symbol(variable)) %>% 
      summarize(lobbying = mean(Code_appearances), size = n()) %>% 
      filter(size >= group_cutoff) %>% 
      mutate(fills = !!as.symbol(variable)) %>% 
      arrange(lobbying) %>% 
      rename(variable = !!as.symbol(variable))
    
    if (order) {
      grouped_data <- grouped_data %>% 
        mutate(variable = factor(variable, levels = unique(variable)))
    }
    
    g <- ggplot(grouped_data, aes(x = lobbying, y = variable, fill = fills)) +
      geom_col(width = 0.8)
  }
  
  
  
  x_cutoff <- max(grouped_data$lobbying) * 1.2
  
  label_size <- ifelse(nrow(grouped_data >= 10), 4, 1.2)
  
  g <- g + 
    geom_text(aes(label = round(lobbying, 2)), hjust= -0.1, size = label_size) +
    labs(title  = title,
       subtitle = subtitle,
       caption  = caption,
       x = xlab,
       y = ylab,
       fill = colors) +
    theme_pub(type = "bar") +
    expand_limits(x = x_cutoff)
  
  return(g)
}
```


```{r}
#Second of three reuseable templates for plots because I use a similar format for several plots
scatterplots_lobby <- function(variable, data = lobby_bills_df, title1 = NULL, title2 = NULL, xlab1 = NULL, xlab2 = NULL, ylab1 = "Log Lobbying", ylab2 = "Average Lobbying", colors = NULL, group_cutoff = 0, smooth = T) {
  
  g1 <- ggplot(data = lobby_bills_df, aes(x = !!as.symbol(variable), y = log(Code_appearances))) +
    geom_point(color = custom_teal) +
    labs(title = title1,
         x = xlab1,
         y = ylab1) +
    scale_size(range=c(2,6)) +
    coord_cartesian(clip='off', expand=F) +
    theme_pub(type='scatter')
  
  
  grouped_data <- lobby_bills_df %>% 
    group_by(!!as.symbol(variable)) %>% 
    summarise(lobbying = mean(Code_appearances), size = n()) %>% 
    filter(size >= group_cutoff)
  
  g2 <- ggplot(grouped_data, aes(x = !!as.symbol(variable), y = log(lobbying), size = size)) +
    geom_point(color = custom_teal) +
    labs(title = title2,
         x = xlab2,
         y = ylab2) +
    #scale_x_continuous(limits=c(0,6 ), breaks=c(0, 3, 6), oob=squish, labels=comma) +
    #scale_y_continuous(limits=c(0,40), breaks=c(0,20,40), oob=squish, labels=comma) +
    #scale_size(range=c(2,6)) +
    coord_cartesian(clip='off', expand=F) +
    theme_pub(type='scatter')
  
  if(smooth) {
    g1 <- g1 +
      geom_smooth()
  }
  
  print(g1)
  print(g2)
  
}
```


```{r}
#Third of three reuseable templates for plots because I use a similar format for several plots
pubcolors <- c(pubred, pubblue, custom_teal, custom_gold, pubdarkgray)
comparison_states <- function(variable, stages = c("CommitteeConsideration", "PassedCongress"), data = lobby_bills_df, title = NULL, xlab = "Percentage of Bills", ylab = NULL, colors = pubcolors[1:length(stages)], group_cutoff = NULL, size_cutoff = NULL) {
  grouped_data <- data %>% 
    group_by(!!as.symbol(variable)) %>% 
    summarise(Introduced = mean(max_type == "Introduced"),
            CommitteeConsideration = mean(max_type == "CommitteeConsideration"),
            PassedCommittee = mean(max_type %in% c("DischargePetition", "CalendarEntry")),
            FloorConsideration = mean(max_type %in% c("FloorConsideration", "ResolvingDifferences")),
            PassedCongress = mean(max_type %in% c("Veto", "BecameLaw")),
            size = n()) %>%
    mutate(Introduced = Introduced + CommitteeConsideration + PassedCommittee + FloorConsideration + PassedCongress,
         CommitteeConsideration = CommitteeConsideration + PassedCommittee + FloorConsideration + PassedCongress,
         PassedCommittee = PassedCommittee + FloorConsideration + PassedCongress,
         FloorConsideration = FloorConsideration + PassedCongress)
  
  if(!is.null(group_cutoff)) {
    grouped_data <- grouped_data %>% 
    arrange(desc(size)) %>% 
    head(group_cutoff)
  } else if (!is.null(size_cutoff)) {
      grouped_data <- grouped_data %>% 
        filter(size >= size_cutoff)
  }
  
  grouped_data <- grouped_data %>%
    select_if(names(grouped_data) %in% c(variable, stages)) %>% 
    pivot_longer(cols = -!!as.symbol(variable), names_to = "stage") %>% 
    mutate(stage = factor(stage, levels = rev(c("Introduced", "CommitteeConsideration", "PassedCommittee", "FloorConsideration", "PassedCongress")), labels = rev(c("Introduced", "Committee Consideration", "Passed Committee", "Floor Consideration", "Passed Congress")))) %>%
    arrange(desc(value)) %>% 
    rename(variable =!!as.symbol(variable)) %>% 
    mutate(variable = factor(variable, levels = rev(unique(variable))))
  
  #xlim <- max(grouped_data$value) *1.05
  
  ggplot(grouped_data, aes(x = value, y = variable, fill = stage)) +
    geom_col(width = 0.8, position = position_dodge()) +
    theme_pub(type = "bar") +
    labs(title = title, x = xlab, y = ylab, fill = "Stage Reached") +
    scale_x_continuous(limits = c(0, 1)) +
    scale_fill_manual(values = colors) +
    theme(axis.text = element_text(size = 8), legend.text =  element_text(size = 8))
}
```


## Executive Summary

Lobbying in the 111th Congress varied widely with the most lobbied bills being lobbied up to 10,747 times with an average number of times lobbied of 53.64352. The most lobbied bills included several of the most high profile legislative battles of the 111th Congress including the American Recovery and Reinvestment Act, the American Clean Energy and Security Act, the Affordable Care Act, and the Dodd-Frank Wall Street Reform Act. The bills that were lobbied the most on average were economics bills, environmental bills, bills from the Appropriations Committees, Bills from the House Budget Committee, and bills from the Banking, Housing, and Urban Affairs Act. Bills that advanced further in Congress were lobbied more frequently, as the chart below demonstrates; however, this paper was not able to determine whether lobbying causes bills to advance, whether bills advancing causes them to be lobbied more, both, or whether there is an as-yet unknown underlying variable.

```{r}
levels_order <- c("Introduced", "CommitteeConsideration", "DischargePetition", "CalendarEntry", "FloorConsideration", "ResolvingDifferences", "PassedCongress")
modified_bill_type <- lobby_bills_df %>% 
  mutate(max_type = factor(max_type, levels = levels_order, labels = gsub("([A-Z])", " \\1", levels_order))) 

barplot_lobby("max_type", data = modified_bill_type, group_cutoff = 30, title = "Average Number of Times Lobbied by Bill State", order = F) +
  expand_limits(x = 320)
```


This paper fit three different models that predicted two different response variables. Two types of models were fit in order to predict the number of times a bill was lobbied and another was fit to predict the latest step of the legislative process that a bill would reach.

The two models to predict the number of times that a bill was lobbied had similar coefficients for the predictive variables and made similar predictions about the number of times a bill would be lobbied. In the selected model, the most significant legislative state was passing committee, suggesting that the step from receiving consideration in a committee to passing committee is either one that catches the attention of lobbyists or one that additional influence from lobbyists can prove crucial to a bill achieving. The issue areas with the highest predictors in the selected model, in order, were commerce; finance and financial sector; Environmental protection; science, technology, and communications; and energy. The committees with the highest positive predictors of lobbying were Appropriations; Budget; Agriculture, Nutrition and Forestry; Finance; and Health, Education, Labor, and Pensions. Other variables that corresponded with more lobbying were more associated legislative subjects, more cosponsors, an earlier introduction date, more related bills, and being introduced by the Democratic Party. The cross validated root mean square error of the selected model was 261.7.

In the model for the final legislative state of the bill, more lobbying was associated with bills reaching a later state in the process. Log lobbying had a coefficient of 0.154, which means that increasing the log lobbying by 1 (equivalent to multiplying the total amount of lobbying by e) increases the odds of a bill reaching a later state by a factor of 1.17. Somewhat paradoxically, despite this relationship, many of the issue areas and committees with the highest predictors of reaching a later state had a negative relationship with lobbying. These included issues like Arts, Culture, and Religion and Sports and Recreation as well as committees such as the Small Business Committee. Similarly, issues like Finance and Financial Sector and committees like Finance and Agriculture, Nutrition and Forestry were strong negative predictors of a law advancing even though they were strong positive predictors of a law receiving more lobbying. This suggests an interaction between lobbying and issue area and committee that future work should explore. Other factors that made a bill more likely to advance in this model include more legislative subjects, more cosponsors, being introduced earlier in the session, having more related bills, and being introduced by a Democrat. The model had an out-of sample classification error rate of 30.3%.

While more work is necessary to determine the direction or directions of the relationship between lobbying and bills advancing as well as to understand how lobbying affects the advancement of bills on multiple issues, there are several key takeaways from this analysis. In general, it appears that bills on highly salient issues were more likely to be lobbied, but less likely to advance in Congress. Conversely, bills on low salience issues were less likely to be lobbied but more likely to advance in Congress. Despite this inverse relationship, in general bills that were lobbied more advanced further in Congress. Bills on issues of high salience that did not directly affect economic industries, such as civil rights bills, did not attract as much lobbying as bills of issues of high salience that had direct effect on industry, such as regulatory bills.

